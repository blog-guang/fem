# Static Structural Analysis (静态结构分析)

对标 ANSYS Mechanical Static Structural 模块的完整功能清单与实现计划。

---

## 📋 目录

1. [概述](#1-概述)
2. [理论基础](#2-理论基础)
3. [功能清单](#3-功能清单)
4. [材料模型](#4-材料模型)
5. [单元类型](#5-单元类型)
6. [载荷与边界条件](#6-载荷与边界条件)
7. [接触与连接](#7-接触与连接)
8. [求解器选项](#8-求解器选项)
9. [后处理功能](#9-后处理功能)
10. [高级功能](#10-高级功能)
11. [验证案例](#11-验证案例)
12. [实现路线图](#12-实现路线图)

---

## 1. 概述

### 1.1 定义

**静态结构分析**：计算结构在静态载荷作用下的响应（位移、应力、应变、反力等）。

**假设**：
- 惯性力可忽略（准静态）
- 载荷缓慢施加（无冲击）
- 不考虑时间效应（蠕变、疲劳除外）

### 1.2 适用场景

- 压力容器设计
- 桥梁、建筑结构
- 机械零件强度校核
- 热应力分析
- 装配体预紧力分析

### 1.3 分析类型

| 类型 | 描述 | ANSYS | 本项目 |
|------|------|-------|--------|
| **线性静态** | 小变形、线性材料 | ✅ | ✅ 已实现 |
| **非线性几何** | 大变形、大转动 | ✅ | ❌ P1 |
| **非线性材料** | 塑性、超弹性 | ✅ | ✅ 部分实现 |
| **非线性接触** | 摩擦、分离 | ✅ | ❌ P1 |
| **全非线性** | 几何+材料+接触 | ✅ | ❌ P2 |

---

## 2. 理论基础

### 2.1 线性静态分析

**控制方程**：
```
K · u = F
```

其中：
- `K`：全局刚度矩阵（常数）
- `u`：位移向量
- `F`：载荷向量

**求解**：
- 直接法（LU 分解）
- 迭代法（CG, PCG）

### 2.2 非线性几何分析

**控制方程**（Total Lagrangian）：
```
(K_0 + K_L + K_NL) · Δu = F_ext - F_int
```

其中：
- `K_0`：初始刚度矩阵
- `K_L`：线性几何刚度矩阵
- `K_NL`：非线性几何刚度矩阵
- `F_int`：内力向量

**增量-迭代求解**：
1. **载荷步**（Load Steps）：将载荷分多步施加
2. **平衡迭代**（Equilibrium Iteration）：Newton-Raphson
3. **收敛判据**：残差/位移增量 < 容差

### 2.3 非线性材料分析

**本构积分**：在每个高斯点进行应力更新

**算法**：
- 弹性：直接计算 `σ = D·ε`
- 塑性：返回映射算法（Return Mapping）
- 超弹性：应变能密度导数 `σ = ∂W/∂ε`

**切线刚度**：
```
D_tan = ∂σ/∂ε
```

---

## 3. 功能清单

### 3.1 核心功能对比

| 功能 | ANSYS | 本项目 | 优先级 | 备注 |
|------|-------|--------|--------|------|
| **线性静态求解** | ✅ | ✅ | - | 已实现 |
| **非线性求解（Newton-Raphson）** | ✅ | ✅ | - | 已实现 |
| **增量求解（Load Steps）** | ✅ | ❌ | P0 | 关键 |
| **自动时间步长** | ✅ | ❌ | P1 | 提高效率 |
| **线搜索（Line Search）** | ✅ | ✅ | - | 已实现 |
| **弧长法（Arc-Length）** | ✅ | ❌ | P1 | 屈曲后 |
| **重启动功能（Restart）** | ✅ | ❌ | P2 | 便利性 |
| **子步细分（Substep）** | ✅ | ❌ | P0 | 关键 |

### 3.2 载荷施加

| 功能 | ANSYS | 本项目 | 优先级 |
|------|-------|--------|--------|
| **载荷递增（Ramped）** | ✅ | ❌ | P0 |
| **载荷阶跃（Stepped）** | ✅ | ❌ | P0 |
| **载荷表格（Tabular）** | ✅ | ❌ | P1 |
| **载荷缩放因子** | ✅ | ❌ | P0 |
| **多载荷工况** | ✅ | ❌ | P1 |
| **载荷组合** | ✅ | ❌ | P2 |

### 3.3 收敛控制

| 选项 | ANSYS | 本项目 | 优先级 |
|------|-------|--------|--------|
| **力收敛准则** | ✅ | ✅ | - |
| **位移收敛准则** | ✅ | ❌ | P0 |
| **能量收敛准则** | ✅ | ❌ | P1 |
| **最大迭代次数** | ✅ | ✅ | - |
| **容差设置** | ✅ | ✅ | - |
| **自适应容差** | ✅ | ❌ | P2 |

---

## 4. 材料模型

### 4.1 线性弹性

| 材料 | ANSYS | 本项目 | 状态 | 备注 |
|------|-------|--------|------|------|
| **各向同性** | ✅ | ✅ | 已实现 | E, ν |
| **正交异性** | ✅ | ✅ | 已实现 | E1, E2, E3, ... |
| **各向异性** | ✅ | ❌ | P2 | 21 个独立常数 |

**必需参数**：
- 杨氏模量 `E` (Pa)
- 泊松比 `ν` (0 ~ 0.5)
- 密度 `ρ` (kg/m³, 可选)
- 热膨胀系数 `α` (1/K, 热应力分析)

### 4.2 塑性模型

| 模型 | ANSYS | 本项目 | 优先级 | 实现细节 |
|------|-------|--------|--------|----------|
| **Bilinear Isotropic** | ✅ | ✅ | - | σ_y, H |
| **Multilinear Isotropic** | ✅ | ❌ | P0 | 表格插值 |
| **Bilinear Kinematic** | ✅ | ✅ | - | σ_y, H_kin |
| **Multilinear Kinematic** | ✅ | ❌ | P0 | Prager 模型 |
| **Chaboche** | ✅ | ❌ | P1 | 多 backstress |
| **Anand (Viscoplasticity)** | ✅ | ❌ | P2 | 率相关 |
| **Drucker-Prager** | ✅ | ❌ | P1 | 岩土材料 |
| **Mohr-Coulomb** | ✅ | ❌ | P2 | 摩擦材料 |
| **Gurson (GTN)** | ✅ | ❌ | P3 | 延性断裂 |

#### 4.2.1 Multilinear Isotropic（多线性等向硬化）

**输入**：应力-应变曲线表格
```
σ_y  | ε_p
-----|-----
250  | 0.0
300  | 0.01
340  | 0.05
370  | 0.1
...  | ...
```

**算法**：
1. 分段线性插值
2. 当前等效塑性应变 → 查表 → 当前屈服应力
3. 返回映射算法

**实现要点**：
- 使用 `std::map<Real, Real>` 存储曲线
- 线性插值函数
- 外推策略（常数或线性）

#### 4.2.2 Chaboche Kinematic Hardening

**模型**：
```
σ_y = σ_y0 + Σ α_i
dα_i/dε_p = (2/3)C_i·dε_p - γ_i·α_i·||dε_p||
```

**参数**：
- `σ_y0`：初始屈服应力
- `C_i`, `γ_i`：硬化参数（通常 3-4 组）

**适用**：
- 循环加载
- 棘轮效应（ratcheting）
- 非比例加载

### 4.3 超弹性模型

| 模型 | ANSYS | 本项目 | 优先级 | 应变能密度 |
|------|-------|--------|--------|------------|
| **Neo-Hookean** | ✅ | ❌ | P1 | `W = C1(Ī1-3) + D1(J-1)²` |
| **Mooney-Rivlin (2-param)** | ✅ | ❌ | P1 | `W = C10(Ī1-3) + C01(Ī2-3)` |
| **Mooney-Rivlin (5-param)** | ✅ | ❌ | P2 | 更高阶项 |
| **Ogden (1st order)** | ✅ | ❌ | P2 | `W = Σ μ_i/α_i (λ1^α + λ2^α + λ3^α - 3)` |
| **Yeoh** | ✅ | ❌ | P2 | `W = Σ C_i0(Ī1-3)^i` |
| **Arruda-Boyce** | ✅ | ❌ | P3 | 8-chain 模型 |

**适用材料**：
- 橡胶
- 生物组织
- 软聚合物

**实现要点**：
- 有限应变框架（Green-Lagrange 应变）
- 应变能密度对 `C`（右 Cauchy-Green 张量）求导
- 不可压缩约束（`J ≈ 1`）

### 4.4 其他材料行为

| 行为 | ANSYS | 本项目 | 优先级 | 备注 |
|------|-------|--------|--------|------|
| **蠕变（Creep）** | ✅ | ❌ | P2 | Norton-Bailey |
| **粘弹性（Viscoelasticity）** | ✅ | ❌ | P3 | Prony 级数 |
| **损伤（Damage）** | ✅ | ❌ | P2 | Lemaitre 模型 |
| **复合材料（Layered）** | ✅ | ❌ | P1 | 层合板理论 |
| **形状记忆合金（SMA）** | ✅ | ❌ | P3 | 相变模型 |

---

## 5. 单元类型

### 5.1 实体单元（Solid）

| 单元 | ANSYS | 本项目 | 节点数 | 阶次 | 优先级 | 备注 |
|------|-------|--------|--------|------|--------|------|
| **SOLID185 (Tet4)** | ✅ | ✅ | 4 | 线性 | - | 已实现 |
| **SOLID186 (Tet10)** | ✅ | ❌ | 10 | 二次 | P0 | 关键！ |
| **SOLID187 (Hex8)** | ✅ | ✅ | 8 | 线性 | - | 已实现 |
| **SOLID285 (Hex20)** | ✅ | ❌ | 20 | 二次 | P1 | 高精度 |
| **SOLID272 (Tet10 quad)** | ✅ | ❌ | 10 | 二次 | P1 | 改进 Tet10 |
| **Wedge15** | ✅ | ❌ | 15 | 二次 | P2 | 棱柱单元 |
| **Pyramid13** | ✅ | ❌ | 13 | 二次 | P2 | 金字塔 |

#### 5.1.1 Tet10（10-node Tetrahedral）- 高优先级！

**为什么重要**：
- Tet4 太硬（shear locking），精度差
- Tet10 是自动网格的核心单元（Tetgen/Gmsh 默认）
- ANSYS 中 80% 的网格使用 Tet10

**形函数**：二次 Lagrange 插值
```
N1 = λ1(2λ1 - 1)      (角点)
N2 = λ2(2λ2 - 1)
N3 = λ3(2λ3 - 1)
N4 = λ4(2λ4 - 1)
N5 = 4λ1λ2           (边中点)
N6 = 4λ2λ3
N7 = 4λ1λ3
N8 = 4λ1λ4
N9 = 4λ2λ4
N10 = 4λ3λ4
```

**高斯积分**：4 点（精确到 3 次多项式）

**实现要点**：
- 减缩积分（1 点）→ 沙漏控制
- 完全积分（4 点）→ 剪切自锁（需要 B-bar 方法）
- 推荐：4 点完全积分 + B-bar 方法

#### 5.1.2 Hex20（20-node Hexahedral）

**节点布局**：
- 8 个角点
- 12 个边中点

**优势**：
- 精度高（二次单元）
- 适合规则网格
- 不易出现 locking

**高斯积分**：
- 完全积分：3×3×3 = 27 点
- 减缩积分：2×2×2 = 8 点（推荐）

### 5.2 壳单元（Shell）

| 单元 | ANSYS | 本项目 | 自由度/节点 | 优先级 | 备注 |
|------|-------|--------|-------------|--------|------|
| **SHELL181 (Quad4)** | ✅ | ❌ | 6 | P1 | 薄壳/厚壳通用 |
| **SHELL281 (Quad8)** | ✅ | ❌ | 6 | P1 | 二次壳单元 |
| **SHELL63 (Tri3)** | ✅ | ❌ | 6 | P2 | 弹性壳 |

**壳单元理论**：
- **Kirchhoff-Love**：薄壳（t/R < 1/20）
- **Mindlin-Reissner**：厚壳，考虑剪切变形
- **ANSYS 默认**：Mindlin-Reissner

**自由度**：
- 3 个平移：`u, v, w`
- 3 个转动：`θx, θy, θz`

**实现要点**：
- 局部坐标系（法向 + 切向）
- 剪切修正系数（5/6）
- 避免剪切自锁（MITC 方法）

### 5.3 梁单元（Beam）

| 单元 | ANSYS | 本项目 | 节点数 | 优先级 | 备注 |
|------|-------|--------|--------|--------|------|
| **BEAM188 (3D)** | ✅ | ❌ | 2 | P1 | Timoshenko 梁 |
| **BEAM189 (3D)** | ✅ | ❌ | 3 | P2 | 二次梁 |

**梁理论**：
- **Euler-Bernoulli**：细长梁（L/h > 10）
- **Timoshenko**：短粗梁，考虑剪切

**自由度**：6 DOF/节点（同壳单元）

**截面属性**：
- 面积 `A`
- 惯性矩 `Iy, Iz, J`（扭转）
- 剪切面积 `Ay, Az`

### 5.4 特殊单元

| 单元 | ANSYS | 本项目 | 优先级 | 用途 |
|------|-------|--------|--------|------|
| **COMBIN14 (Spring)** | ✅ | ❌ | P1 | 弹簧/阻尼器 |
| **MASS21 (Point Mass)** | ✅ | ❌ | P1 | 集中质量 |
| **LINK180 (Truss)** | ✅ | ❌ | P2 | 桁架单元 |
| **MPC184 (Rigid)** | ✅ | ❌ | P1 | 刚性区域 |

---

## 6. 载荷与边界条件

### 6.1 位移约束（Dirichlet BC）

| 类型 | ANSYS | 本项目 | 优先级 | 实现 |
|------|-------|--------|--------|------|
| **固定支撑（Fixed Support）** | ✅ | ✅ | - | `u=v=w=0` |
| **无摩擦支撑（Frictionless）** | ✅ | ❌ | P1 | 法向约束 |
| **圆柱支撑（Cylindrical）** | ✅ | ❌ | P2 | 切向自由 |
| **位移（Displacement）** | ✅ | ✅ | - | 指定 `u, v, w` |
| **对称边界（Symmetry）** | ✅ | ❌ | P0 | 法向位移=0 |
| **反对称边界** | ✅ | ❌ | P2 | 切向位移=0 |

#### 6.1.1 对称边界（Symmetry BC）

**定义**：法向位移为零，切向自由

**数学表达**：
- 法向：`u·n = 0`
- 切向：`u - (u·n)n` 自由

**实现**：
```cpp
// 对于 YZ 平面对称（x=0）
for (node_id in symmetry_nodes) {
    apply_constraint(node_id, DOF_X, 0.0);
}
```

**典型应用**：
- 1/4 模型（两个对称面）
- 1/8 模型（三个对称面）

### 6.2 力载荷（Neumann BC）

| 类型 | ANSYS | 本项目 | 优先级 | 单位 |
|------|-------|--------|--------|------|
| **集中力（Force）** | ✅ | ✅ | - | N |
| **力矩（Moment）** | ✅ | ❌ | P1 | N·m |
| **压力（Pressure）** | ✅ | ❌ | P0 | Pa |
| **体力（Body Force）** | ✅ | ❌ | P1 | N/m³ |
| **重力（Gravity）** | ✅ | ❌ | P0 | m/s² |
| **离心力（Centrifugal）** | ✅ | ❌ | P1 | rad/s |
| **轴承载荷（Bearing）** | ✅ | ❌ | P2 | N |
| **螺栓预紧力（Bolt Pretension）** | ✅ | ❌ | P1 | N |

#### 6.2.1 压力载荷（Pressure）- 关键！

**定义**：作用在表面上的法向分布力

**实现**：
```
F_surface = ∫_Γ N^T · (p · n) dΓ
```

其中：
- `p`：压力值（Pa，正为压缩）
- `n`：外法向量
- `Γ`：表面

**算法**：
1. 识别表面单元（边界面）
2. 计算法向量（节点平均或单元中心）
3. 数值积分（高斯积分）
4. 装配到节点载荷向量

**注意**：
- 大变形下，法向量随变形更新（非线性）
- 压力跟随（Pressure Follower）：法向随当前构型变化

#### 6.2.2 重力载荷（Gravity）

**体力**：
```
f = ρ · g
```

**实现**：
```
F_gravity = ∫_Ω N^T · (ρ · g) dΩ
```

**参数**：
- `ρ`：密度（kg/m³）
- `g`：重力加速度（m/s²，通常 9.81）
- 方向：`[0, 0, -g]`（Z 轴向下）

#### 6.2.3 离心力载荷

**体力**：
```
f = ρ · ω² · r
```

其中：
- `ω`：角速度（rad/s）
- `r`：到转轴的距离

**参数输入**：
- 转速（RPM）
- 转轴位置和方向

### 6.3 热载荷

| 类型 | ANSYS | 本项目 | 优先级 | 备注 |
|------|-------|--------|--------|------|
| **温度（Temperature）** | ✅ | ✅ | - | 热应变 |
| **对流（Convection）** | ✅ | ❌ | P2 | 需热分析 |
| **辐射（Radiation）** | ✅ | ❌ | P3 | 非线性 |
| **热流密度（Heat Flux）** | ✅ | ❌ | P2 | W/m² |

**热应变**：
```
ε_thermal = α · ΔT
```

**应力**：
```
σ = D · (ε_total - ε_thermal)
```

### 6.4 载荷步控制

| 功能 | ANSYS | 本项目 | 优先级 |
|------|-------|--------|--------|
| **多载荷步** | ✅ | ❌ | P0 |
| **载荷递增（Ramped）** | ✅ | ❌ | P0 |
| **载荷阶跃（Stepped）** | ✅ | ❌ | P0 |
| **载荷缩放因子** | ✅ | ❌ | P0 |
| **时间步长控制** | ✅ | ❌ | P1 |
| **自动子步细分** | ✅ | ❌ | P0 |

#### 6.4.1 载荷步设计

**概念**：
- **Load Step**：一个完整的载荷历史
- **Substep**：载荷步的细分（增量）
- **Time**：伪时间（非真实时间）

**示例**：预紧 → 工作载荷
```
Load Step 1: 螺栓预紧（0 → 1000 N）
  - Substeps: 10
  - Time: 0 → 1

Load Step 2: 工作压力（0 → 10 MPa）
  - Substeps: 20
  - Time: 1 → 2
```

**实现**：
```cpp
struct LoadStep {
    int id;
    std::map<int, Real> bc_start;  // 起始边界条件
    std::map<int, Real> bc_end;    // 终止边界条件
    int num_substeps;              // 子步数
    Real time_start, time_end;     // 伪时间
};
```

---

## 7. 接触与连接

### 7.1 接触类型

| 类型 | ANSYS | 本项目 | 优先级 | 描述 |
|------|-------|--------|--------|------|
| **Bonded（绑定）** | ✅ | ❌ | P1 | 完全粘接 |
| **No Separation（无分离）** | ✅ | ❌ | P1 | 仅法向粘接 |
| **Frictionless（无摩擦）** | ✅ | ❌ | P1 | 法向接触 |
| **Frictional（摩擦）** | ✅ | ❌ | P1 | Coulomb 摩擦 |
| **Rough（粗糙）** | ✅ | ❌ | P2 | 无滑移 |

### 7.2 接触算法

| 算法 | ANSYS | 本项目 | 优先级 | 备注 |
|------|-------|--------|--------|------|
| **Penalty Method** | ✅ | ❌ | P0 | 简单高效 |
| **Augmented Lagrange** | ✅ | ❌ | P1 | 精度高 |
| **Pure Lagrange** | ✅ | ❌ | P2 | 引入约束 |
| **MPC（刚性）** | ✅ | ❌ | P1 | 多点约束 |

#### 7.2.1 Penalty Method（罚函数法）

**原理**：用弹簧模拟接触
```
F_n = k_n · g    (g < 0, 穿透)
F_t = k_t · Δu_t  (摩擦)
```

其中：
- `g`：间隙（gap，负值表示穿透）
- `k_n`：法向接触刚度（罚参数）
- `k_t`：切向接触刚度

**罚参数选择**：
```
k_n = α · E / h
```
- `α`：因子（0.01 ~ 100）
- `E`：杨氏模量
- `h`：单元特征尺寸

**优点**：
- 实现简单
- 不增加自由度

**缺点**：
- 刚度选择敏感
- 允许小穿透

#### 7.2.2 Augmented Lagrange Method

**原理**：Penalty + Lagrange 乘子迭代

**算法**：
1. 初始猜测：`λ_0 = 0`
2. Penalty 求解：`u_k = solve(K + k_n·C, F + λ_k·C)`
3. 更新乘子：`λ_{k+1} = λ_k + k_n·g(u_k)`
4. 重复直到收敛

**优点**：
- 精度高（几乎无穿透）
- 对罚参数不敏感

**缺点**：
- 需要多次迭代

### 7.3 摩擦模型

**Coulomb 摩擦**：
```
if (||τ|| < μ·σ_n)  → stick (粘滞)
   τ = -k_t · Δu_t

else                → slip (滑动)
   τ = μ · σ_n · (Δu_t / ||Δu_t||)
```

其中：
- `μ`：摩擦系数
- `σ_n`：法向接触压力
- `τ`：切向摩擦力

**实现**：
- Trial state（试探）：假设 stick
- Check：`||τ|| < μ·σ_n`？
- 若否：return mapping 到滑动面

### 7.4 连接（Joints）

| 类型 | ANSYS | 本项目 | 优先级 | 描述 |
|------|-------|--------|--------|------|
| **Fixed Joint** | ✅ | ❌ | P1 | 刚性连接 |
| **Revolute** | ✅ | ❌ | P2 | 铰接 |
| **Translational** | ✅ | ❌ | P2 | 滑动副 |
| **Spherical** | ✅ | ❌ | P2 | 球铰 |
| **General** | ✅ | ❌ | P3 | 自定义 |

---

## 8. 求解器选项

### 8.1 线性求解器

| 求解器 | ANSYS | 本项目 | 适用规模 | 优先级 |
|--------|-------|--------|----------|--------|
| **Sparse Direct (PARDISO)** | ✅ | ❌ | <100k DOF | P0 |
| **PCG (Jacobi)** | ✅ | ✅ | 任意 | - |
| **PCG (SSOR)** | ✅ | ✅ | 任意 | - |
| **PCG (ILU)** | ✅ | ✅ | <1M DOF | - |
| **PCG (AMG)** | ✅ | ✅ | >1M DOF | - |

#### 8.1.1 PARDISO（Intel MKL）- 高优先级！

**为什么重要**：
- ANSYS 默认求解器（中小规模）
- 精度高、稳定
- 适合工程实际（10k ~ 100k DOF）

**集成方式**：
```cpp
#include <mkl_pardiso.h>

class PARDISOSolver : public LinearSolver {
    // Intel MKL PARDISO 接口封装
};
```

**参数**：
- `mtype = 11`：实对称正定矩阵
- `iparm[0] = 1`：使用默认参数
- `iparm[1] = 2`：嵌套分解（并行）

### 8.2 非线性求解器

| 方法 | ANSYS | 本项目 | 优先级 | 适用 |
|------|-------|--------|--------|------|
| **Full Newton-Raphson** | ✅ | ✅ | - | 通用 |
| **Modified Newton-Raphson** | ✅ | ❌ | P1 | 节省时间 |
| **Quasi-Newton (BFGS)** | ✅ | ❌ | P2 | 避免刚度更新 |
| **Arc-Length Method** | ✅ | ❌ | P1 | 屈曲后 |

#### 8.2.1 Modified Newton-Raphson

**策略**：刚度矩阵保持不变（或每 N 步更新一次）

**优点**：
- 减少刚度矩阵计算次数
- 减少线性求解次数（LU 分解可复用）

**缺点**：
- 收敛慢（线性收敛 vs 二次收敛）

**适用**：
- 轻微非线性
- 刚度矩阵计算昂贵

#### 8.2.2 Arc-Length Method（弧长法）

**目的**：追踪屈曲后路径、极值点

**控制方程**：
```
(K_T + λ·ΔK) · Δu = ΔF
Δu·Δu + λ²·ΔF·ΔF = Δs²  (弧长约束)
```

**优点**：
- 可以越过极值点
- 追踪回弹、折叠

**应用**：
- 薄壳屈曲
- 柔性结构大变形

### 8.3 收敛控制

| 准则 | ANSYS | 本项目 | 公式 |
|------|-------|--------|------|
| **力收敛** | ✅ | ✅ | `||R|| < tol·||F||` |
| **位移收敛** | ✅ | ❌ | `||Δu|| < tol·||u||` |
| **能量收敛** | ✅ | ❌ | `|Δu·R| < tol·|u·F|` |

**推荐组合**（ANSYS 默认）：
```
Force:        ||R|| < 0.001·||F||
Displacement: ||Δu|| < 0.05·||u||  (可选)
```

**自适应容差**：
```
tol_k = max(tol_min, tol_0 / k)
```
随迭代次数降低容差要求。

---

## 9. 后处理功能

### 9.1 应力结果

| 结果 | ANSYS | 本项目 | 优先级 | 公式 |
|------|-------|--------|--------|------|
| **von Mises 应力** | ✅ | ✅ | - | `√(3J2)` |
| **主应力（σ1, σ2, σ3）** | ✅ | ❌ | P0 | 特征值 |
| **最大主应力** | ✅ | ❌ | P0 | `max(σ1, σ2, σ3)` |
| **最小主应力** | ✅ | ❌ | P0 | `min(σ1, σ2, σ3)` |
| **最大剪应力** | ✅ | ❌ | P0 | `(σ1-σ3)/2` |
| **Tresca 应力** | ✅ | ❌ | P1 | `σ1 - σ3` |
| **应力强度** | ✅ | ❌ | P1 | 用于断裂 |

#### 9.1.1 主应力计算

**算法**：求解应力张量特征值
```
det(σ - λI) = 0
```

**3D 解析解**（立方方程）：
```cpp
// Cardano 公式或数值方法（QR 算法）
eigen_values(stress_tensor, sigma1, sigma2, sigma3);
```

**主方向**：对应的特征向量

### 9.2 应变结果

| 结果 | ANSYS | 本项目 | 优先级 |
|------|-------|--------|--------|
| **总应变** | ✅ | ✅ | - |
| **弹性应变** | ✅ | ✅ | - |
| **塑性应变** | ✅ | ✅ | - |
| **等效塑性应变** | ✅ | ✅ | - |
| **热应变** | ✅ | ❌ | P1 |
| **蠕变应变** | ✅ | ❌ | P2 |

### 9.3 其他结果

| 结果 | ANSYS | 本项目 | 优先级 | 备注 |
|------|-------|--------|--------|------|
| **位移** | ✅ | ✅ | - | X, Y, Z, 总位移 |
| **反力** | ✅ | ✅ | - | 约束节点 |
| **应变能** | ✅ | ❌ | P1 | `0.5·u^T·K·u` |
| **接触力** | ✅ | ❌ | P1 | 法向+切向 |
| **接触压力** | ✅ | ❌ | P1 | 接触面 |
| **接触状态** | ✅ | ❌ | P1 | Open/Close/Slide |

### 9.4 安全系数

| 准则 | ANSYS | 本项目 | 优先级 | 公式 |
|------|-------|--------|--------|------|
| **von Mises** | ✅ | ❌ | P0 | `SF = σ_y / σ_vm` |
| **Tresca** | ✅ | ❌ | P1 | `SF = σ_y / (σ1-σ3)` |
| **Maximum Principal** | ✅ | ❌ | P1 | `SF = σ_y / σ1` |
| **Mohr-Coulomb** | ✅ | ❌ | P2 | 岩土材料 |

**后处理流程**：
```cpp
for (each element) {
    compute_stress(element, stress);
    sigma_vm = von_mises(stress);
    safety_factor = sigma_y / sigma_vm;
    if (safety_factor < 1.0) {
        mark_as_failed(element);
    }
}
```

### 9.5 路径结果（Path Results）

| 功能 | ANSYS | 本项目 | 优先级 |
|------|-------|--------|--------|
| **沿路径提取** | ✅ | ❌ | P1 |
| **最大值路径** | ✅ | ❌ | P1 |
| **截面结果** | ✅ | ❌ | P2 |

**实现**：
```cpp
class PathResult {
    std::vector<Vec3> path_points;  // 路径点
    std::vector<Real> stress_values; // 应力值

    void extract_along_path(const Mesh& mesh,
                           const std::vector<Real>& nodal_stress);
};
```

---

## 10. 高级功能

### 10.1 子模型（Submodeling）

| 功能 | ANSYS | 本项目 | 优先级 |
|------|-------|--------|--------|
| **位移映射** | ✅ | ❌ | P2 |
| **应力映射** | ✅ | ❌ | P2 |
| **Cut Boundary** | ✅ | ❌ | P2 |

**原理**：
1. 粗网格全局分析
2. 细网格局部分析（边界条件从粗网格插值）

### 10.2 自适应网格

| 功能 | ANSYS | 本项目 | 优先级 |
|------|-------|--------|--------|
| **h-refinement** | ✅ | ❌ | P2 |
| **p-refinement** | ✅ | ❌ | P3 |
| **误差估计** | ✅ | ❌ | P2 |

**误差指标**：
- 应力梯度
- 能量范数

### 10.3 对称/周期边界

| 类型 | ANSYS | 本项目 | 优先级 |
|------|-------|--------|--------|
| **镜像对称** | ✅ | ❌ | P0 |
| **轴对称** | ✅ | ❌ | P1 |
| **循环对称** | ✅ | ❌ | P1 |
| **周期边界** | ✅ | ❌ | P2 |

---

## 11. 验证案例

### 11.1 NAFEMS Benchmarks

| 案例 | 描述 | 解析解 | 优先级 |
|------|------|--------|--------|
| **LE1** | 薄板拉伸 | σ_xx = P/A | P0 |
| **LE10** | Z-cantilever | δ_tip = ... | P0 |
| **LE11** | 厚板圆孔 | 应力集中 | P1 |
| **NLE1** | 塑性弯曲 | J2 塑性 | P1 |

### 11.2 ANSYS 对标测试

| 案例 | 几何 | 材料 | 载荷 | 目标误差 |
|------|------|------|------|----------|
| **悬臂梁** | 10×1×1 m | 弹性 | 端部力 | <1% |
| **压力容器** | 筒体+封头 | 弹性 | 内压 | <2% |
| **螺栓连接** | 多零件 | 弹性 | 预紧+压力 | <5% |
| **塑性拉伸** | 圆棒 | J2 塑性 | 拉力 | <5% |

### 11.3 解析解对比

| 问题 | 解析解 | 验证内容 |
|------|--------|----------|
| **Euler 梁挠度** | `w = PL³/(3EI)` | 位移精度 |
| **Hertz 接触** | `a = ...` | 接触压力 |
| **无限板孔** | `σ_θ(r=a) = 3P` | 应力集中 |
| **球壳内压** | `σ = pr/(2t)` | 应力分布 |

---

## 12. 实现路线图

### 12.1 Phase 0: 增量求解框架（1周）

**目标**：支持载荷步和子步

**任务**：
- [ ] `LoadStep` 类设计
- [ ] `Substep` 细分算法
- [ ] 载荷递增/阶跃实现
- [ ] 收敛历史记录

**测试**：
- 多载荷步简单算例
- 载荷缩放验证

### 12.2 Phase 1: 单元库扩展（2-3周）

**优先级**：
1. **Tet10**（关键！）
   - 形函数实现
   - B-bar 方法（避免 locking）
   - 4 点高斯积分
   - 验证：NAFEMS LE10

2. **Hex20**
   - 20-node 形函数
   - 2×2×2 减缩积分
   - 验证：厚板弯曲

3. **Shell181**（如有时间）
   - Mindlin-Reissner 理论
   - MITC 方法
   - 验证：薄板挠度

### 12.3 Phase 2: 压力载荷（1周）

**任务**：
- [ ] 表面单元识别
- [ ] 法向量计算
- [ ] 压力积分（面积分）
- [ ] Pressure Follower（大变形）

**测试**：
- 圆筒内压（解析解对比）
- 球壳内压

### 12.4 Phase 3: 对称边界条件（3天）

**任务**：
- [ ] 对称面识别
- [ ] 法向约束施加
- [ ] 1/4、1/8 模型验证

**测试**：
- 立方体拉伸（1/8 模型）
- 圆柱内压（1/4 模型）

### 12.5 Phase 4: 主应力后处理（1周）

**任务**：
- [ ] 特征值求解（Eigen 或手写）
- [ ] 主应力排序
- [ ] 主方向计算
- [ ] 安全系数计算

**测试**：
- 单轴拉伸（主应力 = σ_xx）
- 纯剪切（主应力 = ±τ）

### 12.6 Phase 5: Multilinear Plasticity（1-2周）

**任务**：
- [ ] 应力-应变曲线插值
- [ ] 返回映射算法扩展
- [ ] 切线刚度更新

**测试**：
- ANSYS 对标：塑性拉伸曲线
- NAFEMS NLE1

### 12.7 Phase 6: 接触力学基础（2-3周）

**任务**：
- [ ] Penalty Method 实现
- [ ] Frictionless contact
- [ ] Frictional contact (Coulomb)
- [ ] 接触检测算法

**测试**：
- Hertz 接触（解析解）
- 两球接触

### 12.8 Phase 7: PARDISO 集成（1周）

**任务**：
- [ ] Intel MKL PARDISO 封装
- [ ] SolverFactory 注册
- [ ] 性能对比测试

**测试**：
- 10k DOF 问题（vs PCG）
- 100k DOF 问题

---

## 📊 总结：优先级排序

### P0（立即实现，0-1个月）
1. ✅ 增量求解框架（LoadStep, Substep）
2. ✅ **Tet10 单元**（关键！）
3. ✅ 压力载荷
4. ✅ 对称边界条件
5. ✅ 主应力后处理
6. ✅ PARDISO 集成

### P1（近期计划，1-3个月）
1. Hex20 单元
2. Shell181 单元
3. Multilinear Plasticity
4. 接触力学（Frictionless + Frictional）
5. 重力/离心力载荷
6. Modified Newton-Raphson
7. Arc-Length Method

### P2（中期计划，3-6个月）
1. 超弹性材料（Neo-Hookean, Mooney-Rivlin）
2. Beam 单元
3. 子模型功能
4. 自适应网格
5. 蠕变/粘弹性

### P3（长期规划，6个月+）
1. 高级塑性模型（GTN, Chaboche）
2. 复合材料层合板
3. 拓扑优化
4. 形状优化

---

## 🎯 第一阶段目标（1个月内）

完成 P0 所有功能后，静态结构分析将达到：

**功能覆盖率**：
- ANSYS Static Structural 核心功能：~50%
- 可用于实际工程分析（中小规模）
- 支持线性+非线性材料
- 支持基本接触

**性能目标**：
- 100k DOF 问题 < 1 分钟（PARDISO）
- 1M DOF 问题 < 10 分钟（PCG+AMG）
- ANSYS 误差 < 5%

**验证标准**：
- 通过 5+ NAFEMS 标准测试
- 通过 10+ ANSYS 对标测试
- 单元测试覆盖率 > 80%

---

**下一步**：开始实现 Phase 0 - 增量求解框架！
